%-------------------------------------------------- 
%
%    Damian Skrzypiec
%
%    14.10.2017
%
%    Separation Tree Lemma 
%
%-------------------------------------------------- 

The following lemma says that every route between two vertices that are separated by some separator in the separation tree
is blocked by this separator. This lemma will be used in the proof of theorem \ref{LCDSkeletonThm}. 

\begin{lemma} \label{lemma9}
	Let $G = (V, E)$ be a chain graph, $\mc{T}(G, \mc{C})$ be a separation tree and $S$ be a separator of $\mc{T}(G, \mc{C})$.
	Suppose that $u \in V_1(S) \setminus S$, $u \in V_2(S) \setminus S$ and $\rho$ is a route from $u$ to $v$ in $G$. Let $W$ denote
	set of vertices of $\rho$. Then $\rho$ is blocked by $W \cap S$ and any vertex set contaning $W \cap S$.
\end{lemma}

\begin{prf}
	We can assume that route $\rho$ is of the form 
	\begin{equation}
		\rho = \left( 
				\overbrace{v^1_1, v^1_2, \dots, v^1_k}^{V_1(S) \setminus S}, 
				\underbrace{s_1, \dots, s_n}_{S}, 
				\overbrace{v^2_1, v^2_2, \dots v^2_m}^{V_2(S) \setminus S}  
			\right) 
	\end{equation}
	Otherwise every vertex of $\rho$ would be in either $V_1(S) \setminus S$ or in $V_2(S) \setminus S$. That would imply existance of
	two adjacent vertices $v \in V_1(S) \setminus S$ and $w \in V_2(S) \setminus S$ and further that would contradictory to condition from separation 
	tree definition $\cSep{V_1(S) \setminus S}{V_2(S) \setminus S}{S}{G}$.
	
	Let $\psi$ be the subroute of the vertices $(v^1_k, s_1, \dots, s_n, v^2_1)$ and $W_{\psi}$ be the vertex set of $\psi$ with vertices $\{v^1_k, v^2_1\}$
	excluded. Since $W_{\psi} \subset S$ there is at least one non collider section of route $\psi$ and, from lemma \ref{lemma1}, every non collider section on $\psi$
	is hit by $W_{\psi}$. Therefore route $\rho$ is blocked by set $S$ or any set contaning $S$ when $\psi$ is part of non collider section of $\rho$.
	To complete proof we have to show that thesis is satisfied in case when subroute $\psi$ is part of collider section of route $\rho$.
	From now on we can assume that route $\rho$ has collider section $\sigma$ of the form
	
	\begin{equation}
		\sigma = v^1_i \rightarrow v^1_{i+1} - \dots - v^1_k - s_1 - \dots - s_n - v^2_1 - \dots v^2_j \leftarrow v^2_{j+1} 
	\end{equation}
	for some $i \in \{1, 2, \dots k \}$ and $j \in \{ 1, 2, \dots, m\}$. We have to consider few corner cases. 
	In case when $v^1_{i} \in S$ then exists a non collider section of $\rho$ which is blocked by $S$ or any set contaning $S$. 
	In case when $v^1_{i} \in V_1(S) \setminus S$ and $v^2_{j+1} \in S$ then exists a non collider section of $\rho$ which is blocked by $S$ or any set contaning $S$.
	In case when $v^2_{j+1} \in V_1(S) \setminus S$ then we can consider a non collider section of route $\rho$ which starts from $v^2_{j+1}$.
	Now it is sufficient to consider regular case when $v^1_{i} \in V_1(S) \setminus S$ and $v^2_{j+1} \in V_2(S) \setminus S$. This case cannot occure
	in separation tree because that would imply $v^1_{i} \not \bigCI v^2_{j+1} \mid S$ which is contradictory to condition from separation tree definition
	$\cSep{V_1(S) \setminus S}{V_2(S) \setminus S}{S}{G}$. 
	\QED
\end{prf}


\begin{lemma} \label{lemma10}
	Let $G = (V, E)$ be a chain graph, $\mc{T}(G, \mc{C})$ be a separation tree of chain graph $G$ and $u, v \in V$ are non adjacent vertices in $G$.
	If $\rho$ is a route from $u$ to $v$ is not contained in $\mbox{An}(u) \cup  \mbox{An}(v)$, then $\rho$ is blocked by any subset of
	$\mbox{An}(u) \cup  \mbox{An}(v)$.
\end{lemma}

\begin{prf}
	Since route $\rho$ is not contained in set $\mbox{An}(u) \cup  \mbox{An}(v)$ there exists vertices $s_1, s_2, t_1, t_2$ such that 
	route $\rho$ is of the form

	\begin{equation}
		\begin{cases}
			\rho = \left(u, \dots, s_1, s_2, \dots, t_1, t_2, \dots, v \right)   \\ 
			\{ s_1, t_2 \} \in \mbox{An}(u) \cup  \mbox{An}(v)  \\ 
			\{ s_2, t_1 \} \cap \left(\mbox{An}(u) \cup  \mbox{An}(v) \right) = \emptyset	
		\end{cases}
	\end{equation}
	In this case we have $s_1 \rightarrow s_2$ and $t_1 \leftarrow t_2$, because otherwise $s_2$ or $t_1$ would be in set 
	$\mbox{An}(u) \cup  \mbox{An}(v)$. Therefore there exists at least one collider section between vertices $s_1$ and $t_2$ 
	on route $\rho$ that is outside of $\mbox{An}(u) \cup  \mbox{An}(v)$. Thus route $\rho$ is blocked by 
	any subset of $\mbox{An}(u) \cup  \mbox{An}(v)$.
	\QED
\end{prf}


\begin{lemma} \label{lemma12}
	Let $G = (V, E)$ be a chain graph, $\mc{T}(G, \mc{C})$ be a separation tree of chain graph $G$
	and $u, v$ are two adjacent vertices. Then there exists node $C \in \mc{T}(G, \mc{C})$ which contains both vertices $u$ and $v$.
\end{lemma}

\begin{prf}
	Let suppose opposite. In this case there exists separator $K$ in $\mc{T}(G), \mc{C}$ such that $u \in V_1(K)$ and $v \in V_2(K)$.
	And by separation tree definition this implies that $\cSep{u}{v}{K}{G}$ and it is not possible becasue $u$ and $v$ are adjacent vertices.
	\QED
\end{prf}



\textbf{TODO:} Add smoe description of the following lemma.

\begin{lemma} \label{lemma11}
	Let $G = (V, E)$ be a chain graph and $\mc{T}(G, \mc{C})$ be a separation tree for $\mc{C} = \{C_1, \dots, C_k \}$. 
	Let $u$ and $v$ be a non adjacent vertices in $G$ such that $u, v \in C_i$ for some $i \in \{1, \dots, k \}$. 
	If $u$ and $v$ are not contained in the same separator connected to $C_i$ then there exists a subset $S$ of $C_i$ such that
	$\cSep{u}{v}{S}{G}$.
\end{lemma}

\begin{prf}
	We show that the following set of vertices 
	\begin{equation} \label{eq:S}
		S = \left( \mbox{An}(u) \cup \mbox{An}(v) \right) \cap \left( C_i \setminus \{ u, v\} \right)
	\end{equation} 
	is the c-separator of vertices $u$ and $v$. Let $\rho$ be a route from $u$ to $v$ in graph $G$. If route $\rho$ is not contained in 
	set $\mbox{An}(u) \cup \mbox{An}(v)$ then $\rho$ is blocked by $S$, by lemma \ref{lemma10}. Therefore from now on we can assume that
	route $\rho$ is contained in set $\mbox{An}(u) \cup \mbox{An}(v)$. To show that $S$ is c-separator we consider the following cases of
	first section of route $\rho$ containing vertex $u$.

	\begin{enumerate}
		\item $u - s_1 - \dots - s_n \leftarrow x$ where $x \neq v$ and $x \in C_i$.
			In this case $x \in \mbox{An}(u)$ and $x\in C_i$, therefore $x \in S$. That implies
			existance of non collider section containing $x$ which is hit by $S$. Thus $u$ and $v$ 
			are c-separated by $S$.

		\item $u - s_1 - \dots - s_n \rightarrow x - t_1 - \dots - t_m \rightarrow y$ where $x \neq v$ and $x \in C_i$.
			In this case $x \in \mbox{An}(u) \cup \mbox{An}(v)$ but $x \notin \mbox{An}(u)$, thus $x \in \mbox{An}(v)$.
			Because of $x \in C_i$ and $x \in \mbox{An}(v)$ we know that $x \in S$. Similar to the previous case
			vertices $u$ and $v$ are c-separated because there is at least one non collider section of route $\rho$ 
			containing $x$ which is hit by $S$.

		\item $u - s_1 - \dots - s_n \rightarrow x - t_1 - \dots - t_m \leftarrow y$ where $x \neq v$ and $x,y \in C_i$.

	\end{enumerate}
	
	
\end{prf}











